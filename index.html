<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="https://use.typekit.net/avz8xwn.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SLS Generator — Order of the Arrow (Unofficial)</title>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --cream:    #e6e7e8;
      --parchment:#EDE5D4;
      --gold:     ;
      --gold-lt:  #36454F;
      --bark:     #650812;
      --moss:     #2D4A2D;
      --red:      #650812;
      --border:   #36454F;
      --shadow:   rgba(44,31,14,0.18);
    }

    html { font-size: 16px; scroll-behavior: smooth; }

    body {
      font-family: 'museo-sans', sans-serif;
      background: var(--cream);
      color: var(--bark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ── Texture overlay ── */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }

    /* ── Header ── */
    header {
      position: relative; z-index: 1;
      background: var(--bark);
      border-bottom: 3px solid var(--gold);
      padding: 2rem 2rem 1.6rem;
      text-align: center;
    }

    header::after {
      content: '';
      display: block;
      height: 1px;
      background: var(--gold-lt);
      opacity: 0.4;
      margin-top: 1.4rem;
    }
      .header-img {
        max-width: 720px;
        width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
      }
    .header-eyebrow {
      font-family: 'museo-slab', serif;
      font-size: 0.7rem;
      letter-spacing: 0.25em;
      color: var(--gold-lt);
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    .header-title {
      font-family: 'museo-slab', serif;
      font-size: clamp(1.4rem, 3.5vw, 2.2rem);
      font-weight: 700;
      color: var(--cream);
      line-height: 1.2;
      letter-spacing: 0.04em;
    }

    .header-title span {
      color: var(--gold-lt);
    }

    .header-sub {
      font-family: 'museo-slab', serif;
      font-style: normal;
      font-size: 1.05rem;
      color: #D9365A;
      margin-top: 0.35rem;
    }

    /* ── Main layout ── */
    main {
      position: relative; z-index: 1;
      flex: 1;
      max-width: 780px;
      width: 100%;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 4rem;
    }

    /* ── Card ── */
    .card {
      background: #FFFDF8;
      border: 1px solid var(--border);
      border-radius: 2px;
      box-shadow: 0 4px 24px var(--shadow), 0 1px 0 var(--gold) inset;
      padding: 2.2rem 2.4rem;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 6px; left: 6px; right: 6px; bottom: 6px;
      border: 1px solid rgba(196,169,107,0.2);
      border-radius: 1px;
      pointer-events: none;
    }

    /* ── Section heading ── */
    .section-label {
      font-family: 'museo-slab', serif;
      font-size: 0.65rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .section-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: linear-gradient(to right, var(--border), transparent);
    }

    /* ── Form elements ── */
    .field { margin-bottom: 1.4rem; }

    label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--bark);
      margin-bottom: 0.4rem;
      letter-spacing: 0.01em;
    }

    label .hint {
      font-family: 'museo-sans', sans-serif;
      font-weight: 300;
      font-style: italic;
      color: #8A7355;
      font-size: 0.82rem;
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      font-family: 'museo-sans', sans-serif;
      font-size: .8rem;
      color: var(--bark);
      background: var(--cream);
      border: 1px solid var(--border);
      border-radius: 2px;
      padding: 0.55rem 0.75rem;
      transition: border-color 0.2s, box-shadow 0.2s;
      outline: none;
    }

    input[type="text"]:focus,
    textarea:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(139,105,20,0.1);
    }

    textarea {
      resize: vertical;
      min-height: 160px;
      font-size: 0.92rem;
      font-family: 'museo-sans', sans-serif;
      line-height: 1.5;
    }

    /* ── Radio / toggle groups ── */
    .toggle-group {
      display: flex;
      gap: 0;
      border: 1px solid var(--border);
      border-radius: 2px;
      overflow: hidden;
    }

    .toggle-group input[type="radio"] { display: none; }

    .toggle-group label {
      flex: 1;
      margin: 0;
      padding: 0.55rem 0.5rem;
      text-align: center;
      font-size: 0.88rem;
      font-weight: 400;
      cursor: pointer;
      border-right: 1px solid var(--border);
      background: var(--cream);
      color: #7A6040;
      transition: background 0.15s, color 0.15s;
    }

    .toggle-group label:last-child { border-right: none; }

    .toggle-group input[type="radio"]:checked + label {
      background: var(--bark);
      color: var(--cream);
      font-weight: 600;
    }

    /* ── Section row (region + number side by side) ── */
    .section-row {
      display: flex;
      align-items: flex-end;
      gap: 1rem;
    }

    .section-row .region-group {
      flex: 0 0 auto;
    }

    .section-row .number-group {
      flex: 0 0 auto;
    }

    .section-row .preview-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }

    .section-preview {
      font-family: 'museo-slab', serif;
      font-size: 0.88rem;
      color: #5A4020;
      background: var(--parchment);
      border: 1px solid var(--border);
      border-radius: 2px;
      padding: 0.55rem 0.75rem;
      letter-spacing: 0.03em;
    }

    .section-preview span {
      font-weight: 700;
      color: var(--bark);
    }

    /* ── File drop zone ── */
    .drop-zone {
      border: 2px dashed var(--border);
      border-radius: 2px;
      padding: 1.4rem 1rem;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
      background: var(--cream);
      position: relative;
    }

    .drop-zone:hover,
    .drop-zone.dragover { border-color: var(--gold); background: #F5EDD8; }

    .drop-zone input[type="file"] {
      position: absolute; inset: 0;
      opacity: 0; cursor: pointer; width: 100%; height: 100%;
    }

    .drop-icon { font-size: 1.6rem; margin-bottom: 0.3rem; color: var(--gold); }

    .drop-label {
      font-size: 0.9rem;
      color: #8A7355;
    }

    .drop-label strong { color: var(--bark); }

    .file-chosen {
      margin-top: 0.5rem;
      font-size: 0.82rem;
      color: var(--moss);
      font-style: italic;
    }

    /* ── Submit button ── */
    .btn-generate {
      width: 100%;
      padding: 1rem;
      font-family: 'museo-slab', serif;
      font-size: 0.95rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--cream);
      background: var(--bark);
      border: none;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: background 0.2s;
    }

    .btn-generate::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(255,255,255,0.06), transparent);
    }

    .btn-generate:hover { background: #3D2A12; }
    .btn-generate:active { background: #1A0F04; }

    .btn-generate:disabled {
      background: #9A8870;
      cursor: not-allowed;
    }

    /* ── Status / error ── */
    .status-bar {
      margin-top: 1.2rem;
      padding: 0.9rem 1.1rem;
      border-radius: 2px;
      font-size: 0.92rem;
      display: none;
    }

    .status-bar.loading {
      align-items: center;
      gap: 0.8rem;
      background: var(--parchment);
      border: 1px solid var(--border);
      color: var(--bark);
    }

    .status-bar.error {
      background: #FDF0F0;
      border: 1px solid #D4A0A0;
      color: var(--red);
    }

    .status-bar.success {
      background: #F0F5F0;
      border: 1px solid #90B890;
      color: var(--moss);
    }

    /* ── Spinner ── */
    .spinner {
      width: 18px; height: 18px;
      border: 2px solid var(--border);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      flex-shrink: 0;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ── Format hint table ── */
    .format-hint {
      margin-top: 0.7rem;
      font-size: 0.82rem;
      font-family: 'museo-sans', sans-serif;
      background: var(--parchment);
      border: 1px solid var(--border);
      border-radius: 2px;
      padding: 0.7rem 0.9rem;
      color: #5A4020;
      line-height: 1.6;
    }

    /* ── Footer ── */
    footer {
      position: relative; z-index: 1;
      text-align: center;
      padding: 1.2rem;
      font-size: 0.78rem;
      color: #A89070;
      border-top: 1px solid var(--border);
      font-style: italic;
    }

    /* ── Responsive ── */
    @media (max-width: 520px) {
      .card { padding: 1.4rem 1.2rem; }
      .toggle-group label { font-size: 0.78rem; padding: 0.5rem 0.3rem; }
      .section-row { flex-direction: column; align-items: stretch; }
    }
  </style>
</head>
<body>

<header>
    <img src="/static/header2.png" alt="" class="header-img" />
  <p class="header-sub">SLS Certificate &amp; Name Tent Generator</p>
</header>

<main>
  <form id="genForm" enctype="multipart/form-data">

    <!-- ── Settings ── -->
    <div class="card">
      <p class="section-label">Settings</p>

      <div class="field">
        <label>Section <span class="hint">- applied to all certificates</span></label>
        <div class="section-row">
          <div class="region-group">
            <label style="font-size:0.78rem; margin-bottom:0.3rem;">Region</label>
            <div class="toggle-group">
              <input type="radio" name="region" id="region-e" value="E" checked>
              <label for="region-e">Eastern</label>
              <input type="radio" name="region" id="region-g" value="G">
              <label for="region-g">Gateway</label>
            </div>
          </div>
          <div class="number-group">
            <label for="section-number" style="font-size:0.78rem; margin-bottom:0.3rem;">Number</label>
            <input type="text" id="section-number" name="section_number"
              placeholder="e.g. 9" maxlength="3" autocomplete="off"
              style="width:90px; text-transform:uppercase;">
          </div>
          <div class="preview-group">
            <div class="section-preview">Will appear as: <span id="sectionPreview">Section E…</span></div>
          </div>
        </div>
        <!-- Hidden field carries the assembled value to the server -->
        <input type="hidden" id="section" name="section" value="">
      </div>

      <div class="field">
        <label>Generate</label>
        <div class="toggle-group">
          <input type="radio" name="output_type" id="opt-both" value="both" checked>
          <label for="opt-both">Certificates &amp; Name Tents</label>
          <input type="radio" name="output_type" id="opt-certs" value="certificates">
          <label for="opt-certs">Certificates Only</label>
          <input type="radio" name="output_type" id="opt-tents" value="tents">
          <label for="opt-tents">Name Tents Only</label>
        </div>
      </div>
    </div>

    <!-- ── Input ── -->
    <div class="card">
      <p class="section-label">Names</p>

      <div class="field">
        <label>Upload a CSV file</label>
        <div class="drop-zone" id="dropZone">
          <input type="file" name="csv_file" id="fileInput" accept=".csv,.txt">
          <div class="drop-icon">&#8659;</div>
          <div class="drop-label"><strong>Choose a file</strong> or drag and drop here</div>
          <div class="file-chosen" id="fileChosen"></div>
        </div>
        <div class="format-hint">
          CSV format: &nbsp;Name,Lodge,Role<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Donathan Linebrink,Shenandoah Lodge,Staff<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Christopher Grove,Tipisa Lodge,Participant<br><br>
          <a href="/sample.csv" download="SLS_Sample.csv" style="color:var(--bark); font-weight:600; text-decoration:underline; text-underline-offset:2px;">&#8659; Download sample CSV</a>
        </div>
      </div>

      <button type="submit" class="btn-generate" id="submitBtn">Generate Certificates &amp; Name Tents</button>
      <div class="status-bar loading" id="statusLoading">
        <div class="spinner"></div>
        <span>Generating your documents&hellip;</span>
      </div>
      <div class="status-bar error" id="statusError"></div>
      <div class="status-bar success" id="statusSuccess"></div>
    </div>

  </form>
</main>

<footer>
  Section Leadership Seminar &dash; Order of the Arrow, Scouting America &dash; This tool is in no way managed or operated by the Order of the Arrow. Usage of any logos is not sanctioned and will be removed at request.
</footer>

<script>
  const form         = document.getElementById('genForm');
  const submitBtn    = document.getElementById('submitBtn');
  const fileInput    = document.getElementById('fileInput');
  const fileChosen   = document.getElementById('fileChosen');
  const dropZone     = document.getElementById('dropZone');
  const statusLoad   = document.getElementById('statusLoading');
  const statusErr    = document.getElementById('statusError');
  const statusOk     = document.getElementById('statusSuccess');
  const outputRadios = document.querySelectorAll('input[name="output_type"]');
  const regionRadios = document.querySelectorAll('input[name="region"]');
  const sectionNum   = document.getElementById('section-number');
  const sectionHidden= document.getElementById('section');
  const sectionPreview = document.getElementById('sectionPreview');

  // ── Section assembly ──
  function assembleSection() {
    const region = document.querySelector('input[name="region"]:checked').value;
    const num    = sectionNum.value.trim().toUpperCase();
    const full   = num ? `Section ${region}${num}` : '';
    sectionHidden.value  = full;
    sectionPreview.textContent = num ? `Section ${region}${num}` : `Section ${region}…`;
  }

  // Force uppercase as user types, strip non-alphanumeric
  sectionNum.addEventListener('input', () => {
    const clean = sectionNum.value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
    sectionNum.value = clean;
    assembleSection();
  });

  regionRadios.forEach(r => r.addEventListener('change', assembleSection));
  assembleSection(); // initialise on load

  // ── Update button label ──
  function updateButtonLabel() {
    const type = document.querySelector('input[name="output_type"]:checked').value;
    const labels = {
      both:         'Generate Certificates & Name Tents',
      certificates: 'Generate Certificates',
      tents:        'Generate Name Tents'
    };
    submitBtn.textContent = labels[type];
  }
  outputRadios.forEach(r => r.addEventListener('change', updateButtonLabel));
  updateButtonLabel();

  // ── File input display ──
  fileInput.addEventListener('change', () => {
    fileChosen.textContent = fileInput.files[0]?.name ?? '';
  });

  // ── Drag and drop ──
  dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const f = e.dataTransfer.files[0];
    if (f) {
      const dt = new DataTransfer();
      dt.items.add(f);
      fileInput.files = dt.files;
      fileChosen.textContent = f.name;
    }
  });

  // ── Status helpers ──
  function showLoading()   { statusLoad.style.display = 'flex'; statusErr.style.display = 'none'; statusOk.style.display = 'none'; }
  function showError(msg)  { statusLoad.style.display = 'none'; statusErr.style.display = 'block'; statusErr.textContent = msg; }
  function showSuccess(msg){ statusLoad.style.display = 'none'; statusOk.style.display  = 'block'; statusOk.textContent  = msg; }
  function clearStatus()   { [statusLoad, statusErr, statusOk].forEach(el => el.style.display = 'none'); }

  // ── Form submit ──
  form.addEventListener('submit', async e => {
    e.preventDefault();
    clearStatus();

    // Validate section number
    if (!sectionNum.value.trim()) {
      showError('Please enter a section number before generating.');
      return;
    }

    // Always CSV mode
    const data = new FormData(form);
    data.set('input_mode', 'csv');

    submitBtn.disabled = true;
    showLoading();

    try {
      const resp = await fetch('/generate', { method: 'POST', body: data });

      if (!resp.ok) {
        const body = await resp.json().catch(() => ({ error: 'Unknown server error.' }));
        showError(body.error || `Server error ${resp.status}`);
        return;
      }

      const blob = await resp.blob();
      const cd   = resp.headers.get('Content-Disposition') || '';
      const match = cd.match(/filename="?([^";\n]+)"?/);
      const filename = match ? match[1] : 'SLS_Documents.zip';

      const url = URL.createObjectURL(blob);
      const a   = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click();
      a.remove(); URL.revokeObjectURL(url);

      const type = document.querySelector('input[name="output_type"]:checked').value;
      const msg  = type === 'both'
        ? 'Certificates.pdf and Name_Tents.pdf downloaded as SLS_Documents.zip'
        : filename + ' downloaded successfully.';
      showSuccess(msg);

    } catch (err) {
      showError('Request failed. Check your connection and try again.');
    } finally {
      submitBtn.disabled = false;
    }
  });
</script>
</body>
</html>
